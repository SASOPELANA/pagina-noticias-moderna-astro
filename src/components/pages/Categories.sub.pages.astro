---
// 1. Cambiamos getEntry por getCollection
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

interface Props {
  posts?: any[];
}

const { posts } = Astro.props;

// 2. Traemos todos los archivos de la carpeta 'categories' si no se pasan posts
const categoriesSub = posts || await getCollection("categories");
---

<div>
  <div class="max-w-screen-xl mx-auto my-10">
    <div
      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-5 auto-rows-fr gap-y-6"
    >
      {
        categoriesSub.map((category) => (
          <div class="flex flex-col h-full">
            {/* CARD */}

            <div class="relative h-[230px] overflow-hidden rounded-lg">
              <Image
                src={category.data.image}
                alt={category.data.title}
                class="absolute inset-0 w-full h-full object-cover"
              />

              <div class="absolute inset-0 bg-gradient-to-b from-transparent to-gray-900" />

              {/* TAG + FECHA */}
              <div class="absolute top-0 right-0 left-0 mx-5 mt-2 flex justify-between items-center z-10">
                <a href={`/categories/${category.slug}`} class="cursor-pointer">
                  <span class="text-xs bg-Soft-red/80 text-Off-white px-4 py-1 uppercase">
                    {category.data.subTitle}
                  </span>
                </a>

                <div class="text-Off-white text-center leading-none">
                  <span class="block text-3xl font-semibold">
                    {category.data.dia}
                  </span>
                  <span class="block text-xs uppercase">{category.data.mes}</span>
                </div>
              </div>

              {/* TÍTULO */}
              <div class="absolute bottom-0 p-5 z-10">
                <a href={`/categories/${category.slug}`} class="cursor-pointer">
                  <h3
                    class="text-Off-white font-medium leading-6 hover:underline"
                    transition:name={category.data.title}
                  >
                    {category.data.title}
                  </h3>
                </a>
              </div>
            </div>

            {/* DESCRIPCIÓN ABAJO */}
            <a href={`/categories/${category.slug}`} class="cursor-pointer">
              <p class="mt-3 text-[1rem] text-shadow-Very-dark-blue line-clamp-3 font-semibold hover:text-Soft-red/80">
                {category.data.description}
              </p>
            </a>
          </div>
        ))
      }
    </div>
  </div>
</div>
