---
import type { GetStaticPaths } from "astro";
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

export const getStaticPaths: GetStaticPaths = async () => {
  const items = await getCollection("categories");
  return items.map((item) => ({ params: { slug: item.slug } }));
};

const { slug } = Astro.params;
const items = await getCollection("categories");
const current = items.find((item) => item.slug === slug);

if (!current) {
  throw new Error(`Artículo por categoría no encontrado: ${slug}`);
}

const { Content } = await current.render();
---

<Layout title={current.data.title} description={current.data.description}>
  <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
    <h1
      class="font-bold text-3xl sm:text-4xl lg:text-5xl mb-4 sm:mb-6 leading-tight text-gray-900"
      transition:name={current.data.title}
    >
      {current.data.title}
    </h1>

    <p
      class="text-base sm:text-lg lg:text-xl mb-8 sm:mb-10 text-gray-600 italic font-light border-l-4 border-Soft-orange pl-4 sm:pl-6"
    >
      {current.data.description}
    </p>

    <div
      class="mb-8 sm:mb-12 overflow-hidden rounded-xl shadow-2xl hover:shadow-3xl transition-shadow duration-300"
    >
      <Image
        src={current.data.image}
        alt={current.data.title}
        width={800}
        height={600}
        class="w-full h-auto object-cover"
      />
    </div>

    <div class="prose prose-lg sm:prose-xl max-w-none mb-10 sm:mb-14">
      <Content />
    </div>

    <div
      class="flex justify-center sm:justify-end pt-8 border-t border-gray-200"
    >
      <a
        id="go-back-categories"
        href="/categories"
        class="group inline-flex items-center gap-2 px-6 py-3 border-2 bg-Soft-orange text-white font-semibold rounded-lg shadow-lg hover:text-Soft-red hover:bg-Off-white hover:border-Soft-red"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        Volver
      </a>
    </div>
  </article>
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const backBtn = document.querySelector("#go-back-categories");
    backBtn?.addEventListener("click", (e) => {
      e.preventDefault();
      history.back();
    });
  });
</script>
